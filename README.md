# Long-term field trial Westerfeld

[![code style](https://img.shields.io/badge/code%20style-black-black)](https://github.com/psf/black)
[![DOI](https://zenodo.org/badge/793402108.svg)](https://zenodo.org/doi/10.5281/zenodo.13709848)

Accompanying repository for the data
set ["Westerfeld: Long-term field trial on tillage and fertilization in crop rotation"](https://doi.org/10.20387/bonares-w669-gdsd)
([https://doi.org/10.20387/bonares-w669-gdsd](https://doi.org/10.20387/bonares-w669-gdsd)). This repository contains
basic usage instructions, validation source code for the quality assurance of the dataset, data quality reports
generated by [DQ-Kit](https://dqkit.bonares.de), version 1.0, and some examples for the actual use of the dataset.

## Getting started

The following few steps are necessary to get started using the dataset in combination with this repository.

### Get the repository

Clone the repository with [Git](https://www.git-scm.com):
```
git clone https://github.com/raabmarie/long-term_field_trial_westerfeld.git
```

Alternatively, [download](https://github.com/raabmarie/long-term_field_trial_westerfeld/archive/refs/heads/main.zip)
and unzip the repository as a file.

### Install Python dependencies

An installation of [Python 3](https://www.python.org) is required. However, this is only needed for running the examples
of this repository. The dataset is not tied to a specific programming language, so you can also use programming
languages such as [Julia](https://julialang.org) or [R](https://www.r-project.org) or whatever suits you.

All Python dependencies for this repository are listed in the file [`requirements.txt`](requirements.txt).

Create a new virtual environment in the root directory of this repository:
```
python3 -m venv .venv
```

Activate the new environment:
```
source .venv/bin/activate
```

Install requirements:
```
python3 -m pip install -r requirements.txt
```

Alternatively, your favorite IDE might also handle the previous steps.

### Get the dataset

Get the [dataset](https://doi.org/10.20387/bonares-w669-gdsd) from the [BonaRes Repository for Soil and Agricultural Research Data](https://www.bonares.de/research-data).

Move the dataset into the root directory of this repository, i.e., the dataset should be located next to this README.
Please note that this is necessary only to run the examples from this repository without any further modifications.

## Examples

We provide some examples.

### Prepare tables from separated information

The dataset is made up of different data tables for data normalization purposes.
You probably want to merge data from different data tables for further analyses.
We provide some common examples for this in the directory `examples/preparation`.

For example, run `python3 examples/preparation/plant_protection.py` which would create the following table (only the
first five rows are shown):

|    |   Plant_Protection_ID |   Experimental_Year | Date                |   Plot_ID |   Quantity_Liquid |   Quantity_Solid | Plant_Protection_Product   | Plant_Protection_Product_Type   | Crop         | Tillage    | Fertilization   |
|---:|----------------------:|--------------------:|:--------------------|----------:|------------------:|-----------------:|:---------------------------|:--------------------------------|:-------------|:-----------|:----------------|
|  0 |                     1 |                2004 | 2004-03-30T00:00:00 |         1 |              0.25 |              nan | Lotus                      | Herbicide                       | Winter wheat | Cultivator | extensive       |
|  1 |                     2 |                2004 | 2004-04-20T00:00:00 |         1 |              1    |              nan | CCC                        | Growth_regulator                | Winter wheat | Cultivator | extensive       |
|  2 |                     3 |                2004 | 2004-03-30T00:00:00 |         1 |              2.5  |              nan | Basagran_DP                | Herbicide                       | Winter wheat | Cultivator | extensive       |
|  3 |                     4 |                2004 | 2004-06-02T00:00:00 |         2 |              1.2  |              nan | Opus_Top                   | Fungicide                       | Winter wheat | Cultivator | intensive       |
|  4 |                     5 |                2004 | 2004-03-30T00:00:00 |         2 |              0.25 |              nan | Lotus                      | Herbicide                       | Winter wheat | Cultivator | intensive       |

### Printing shapes

Run `python3 examples/misc/shapes.py`.

This example prints out the data category and shape (the number of observations and number of features) for each
individual data table of the dataset. First, it prints out LaTeX code for typesetting a LaTeX table. This result  can be
seen in the paper. And second, it prints out a Markdown table which looks like the following:

| Data category       | Data table                    |   #Observations |   #Features |
|:--------------------|:------------------------------|----------------:|------------:|
| Experimental data   | CROP                          |               6 |           5 |
| Experimental data   | CROP_ROTATION                 |             101 |           5 |
| Experimental data   | EXPERIMENTAL_SETUP            |            4800 |           7 |
| Experimental data   | FACTOR                        |               2 |           3 |
| Experimental data   | FACTOR_1_LEVEL                |               2 |           5 |
| Experimental data   | FACTOR_2_LEVEL                |               2 |           5 |
| Experimental data   | PLANT_VARIETY                 |              38 |           4 |
| Experimental data   | PLOT                          |             240 |           8 |
| Experimental data   | REMARK                        |               9 |           3 |
| Experimental data   | SEED_STOCK                    |              38 |           2 |
| Experimental data   | TREATMENT                     |               4 |           3 |
| Field data          | FERTILIZATION                 |           12527 |           8 |
| Field data          | FERTILIZER                    |               7 |           3 |
| Field data          | HARVEST                       |            4716 |           5 |
| Field data          | PLANT_PROTECTION              |           27536 |           8 |
| Field data          | PLANT_PROTECTION_PRODUCT      |             134 |           4 |
| Field data          | PLANT_PROTECTION_PRODUCT_TYPE |               7 |           3 |
| Field data          | SOWING                        |            4728 |           7 |
| Field data          | TILLAGE                       |            4728 |           6 |
| Field data          | TILLAGE_MEASURE               |               2 |           3 |
| Field data          | YIELD                         |            4716 |           8 |
| Microbe communities | FUNGI                         |          299966 |          18 |
| Microbe communities | BACTERIA                      |          771361 |          18 |
| Microbe communities | BIOPROJECT                    |              10 |           2 |
| Microbe communities | HABITAT                       |               2 |           3 |
| Microbe communities | BENEFICIAL                    |               2 |           3 |
| Microbe communities | KINGDOM                       |               3 |           2 |
| Microbe communities | PHYLUM                        |              91 |           3 |
| Microbe communities | CLASS                         |             264 |           3 |
| Microbe communities | ORDER                         |             629 |           3 |
| Microbe communities | FAMILY                        |            1218 |           3 |
| Microbe communities | GENUS                         |            3025 |           3 |
| Microbe communities | SPECIES                       |            6564 |           3 |
| Soil data           | SOIL_LAB                      |            3866 |          25 |
| Soil data           | SOIL_SAMPLING                 |            3866 |           7 |
| Plant data          | GENE_EXPRESSION               |            3520 |           8 |
| Plant data          | GENE_EXPRESSION_CATEGORY      |               5 |           3 |
| Plant data          | PLANT_LAB                     |             224 |          17 |
| Plant data          | PLANT_SAMPLING                |             224 |           5 |
| Plant data          | ROOT                          |             112 |          25 |

## Validation

There a some source code and HTML files in the [`validation`](validation) directory. These reflect some steps and
results of our data quality assurance measures. We only provide these files for documentation purposes and to ensure
traceability and transparency. It is not possible to run these source code files on your end because we cannot supply
the raw data.

### Checking data after the BonaRes transformation

Directory `validation/bonares_transformation`:

We have used these source code files to compare the raw data with the final dataset created after the transformation for
database storage purposes.

### Evaluating DQ-Kit reports

Directory `validation/dq-kit_reports`:

These file represent the reports generated by [DQ-Kit](https://dqkit.bonares.de), version 1.0, from BonaRes.
DQ-Kit is a Web service for data quality purposes. We mainly checked these results for abnormalities and duplicates in
the final dataset.

### Manually checking for data duplicates

Directory `validation/manual_duplicates`:

We have used these source code files to check the bacteria and fungi data records for data duplicates. We have used this
manual approach because these specific data records couldn't be processed by DQ-Kit due to some file size limits.

## License

This work is licensed under the [MIT License](./LICENSE.txt).
